# 点是否在多边形内算法实现

本目录包含一个用于判断点是否在多边形内的JavaScript实现。该实现采用了经典的**射线法**(Ray Casting Algorithm)来解决地理空间中的点与多边形关系判断问题。

## 核心算法思路

### 射线法原理
- 从待判断的点向右水平发射一条射线
- 统计这条射线与多边形边界的交点数量
- 如果交点数量为奇数，则点在多边形内部；如果为偶数，则点在多边形外部

### 代码实现分析

- **参数说明**：
  - `point`：待判断的点对象，包含`lat`(纬度)和`lng`(经度)属性
  - `pts`：多边形的顶点数组，每个顶点也是包含`lat`和`lng`的对象

- **初始化变量**：
  ```javascript
  var N = pts.length;  // 多边形顶点数量
  var boundOrVertex = true; // 定义点在顶点或边上时视为在内部
  var intersectCount = 0; // 交点计数器
  var precision = 2e-10; // 浮点数计算容差
  ```

- **顶点检查**：如果点恰好是多边形的顶点，直接返回`true`

- **边检查**：遍历多边形的每条边，判断射线是否与边相交

- **快速排除**：
  ```javascript
  if(p.lat < Math.min(p1.lat, p2.lat) || p.lat > Math.max(p1.lat, p2.lat)) {
     p1 = p2;
     continue;
  }
  ```
  如果点的纬度不在边的两个端点纬度之间，可以快速跳过这条边

- **交点计算**：对于可能相交的边，计算射线与边的交点
  ```javascript
  var xinters = (p.lat - p1.lat) * (p2.lng - p1.lng) / (p2.lat - p1.lat) + p1.lng;
  ```
  这是计算*水平射线*与边交点的经度坐标

- **交点判断**：
  ```javascript
  if(p.lng < xinters) { // 如果点在交点左侧
     ++intersectCount;  // 增加交点计数
  }
  ```

- **特殊情况处理**：代码还处理了点在边上、点在顶点上、边为水平线或垂直线等特殊情况

- **结果判断**：
  ```javascript
  if(intersectCount % 2 == 0) { // 偶数个交点，点在多边形外
     return false;
  } else { // 奇数个交点，点在多边形内
     return true;
  }
  ```

## 代码特点

1. **浮点数精度处理**：使用`precision`变量处理浮点数计算的精度问题
2. **边界情况处理**：完善地处理了点在边上、顶点上以及各种特殊几何情况
3. **算法效率**：通过快速排除机制提高算法效率

## 适用范围

这个实现适用于任意简单多边形（不包含交叉边的多边形），是地理信息系统中常用的空间判断算法。

## 使用示例

```javascript
// 定义多边形
var polygon = [
  {lat: 34.809857, lng: 113.597946},
  {lat: 34.799709, lng: 113.780937},
  {lat: 34.704082, lng: 113.777504},
  {lat: 34.699848, lng: 113.619576},
  {lat: 34.731738, lng: 113.585243}
];

// 定义待判断的点
var point = {lat: 34.755717, lng: 113.750038};

// 调用函数进行判断
var isInside = isPointInPolygon(point, polygon);
console.log(isInside); // 输出 true 或 false
```

## 注意事项

- 多边形的顶点必须按顺序排列（顺时针或逆时针均可），不能跳跃
- 本算法使用经纬度坐标（lng为经度，lat为纬度）
- 对于自相交的复杂多边形，可能需要使用其他算法（如缠绕数法）